<p align="center">
  <img width="100%" height="350" src="https://res.cloudinary.com/dq9faptjc/image/upload/v1762001458/Actividad_experimental_N_2_qv2r1u.jpg">
</p>

# Prototipo de Sistema de Alarma Antirrobo (ATmega328P)

Este proyecto implementa un sistema de alarma multizona completo, programado en Lenguaje C para un microcontrolador ATmega328P. El sistema gestiona zonas temporizadas, zonas instantáneas, retardos de entrada/salida y una sirena, utilizando una interfaz de displays de 7 segmentos multiplexados.

## Análisis de Requerimientos

El sistema fue diseñado para cumplir con las siguientes especificaciones:

* **Gestión de Zonas:**
    * **Z1 (Temporizada):** Proporciona un retardo de entrada de 15s. Si la alarma no se desactiva en ese tiempo, la sirena suena.
    * **Z2 y Z3 (Instantáneas):** Disparan la sirena inmediatamente si el sistema está activado. Tienen prioridad sobre cualquier retardo en curso.
* **Control (P1):** Un pulsador maestro permite `Activar` y `Desactivar` el sistema.
* **Retardos Temporizados:**
    * **Retardo de Salida (15s):** Se inicia al `Activar` la alarma para permitir al usuario salir de la zona.
    * **Retardo de Entrada (15s):** Se inicia al detectar `Z1` para permitir al usuario desactivar la alarma.
    * **Tiempo de Sirena (10s):** La sirena (LED/Relé) se activa durante este período.
* **Visualización (Displays):**
    * **Sistema Desactivado:** El `Disp3` muestra la zona (1, 2 o 3) que se activa, para verificación de sensores.
    * **Sistema Activado:** `Disp1` y `Disp2` muestran las cuentas regresivas (salida, entrada, sirena).
    * **Memoria de Alarma:** Tras sonar, `Disp1` muestra la zona que causó la alarma (1, 2 o 3) durante 3 segundos.

---

## Estrategia de Implementación

La lógica del sistema se basa en una **máquina de estados finitos (FSM)** gestionada por interrupciones de timers y pines externos.

### 1. Gestión de Timers

Se utilizaron dos de los tres timers del ATmega328P para gestionar todas las tareas de temporización y visualización:

* **Timer1 (16 bits) $\rightarrow$ Modo CTC (Base de Tiempo: 1s)**
    * Se configuró en modo CTC con un prescaler de 256 y un `OCR1A` de 62499 para generar una interrupción precisa (`TIMER1_COMPA_vect`) cada 1 segundo.
    * Esta ISR actúa como el "reloj" principal del sistema, gestionando las cuentas regresivas de 15s (entrada/salida), 10s (sirena) y 3s (memoria de alarma).
    * Dentro de esta ISR también se realiza el cálculo para separar `segundos_restantes` en dígitos de **decenas** (`/ 10`) y **unidades** (`% 10`).

* **Timer0 (8 bits) $\rightarrow$ Modo Free-Running (Multiplexación)**
    * Se configuró en modo Normal (Free-Running) con un prescaler de 256.
    * La interrupción por desbordamiento (`TIMER0_OVF_vect`) se ejecuta a ~244 Hz.
    * Esta ISR es responsable de la **multiplexación** de los 3 displays de 7 segmentos. La lógica interna de la ISR utiliza la variable `estado_alarma` para decidir cuál de los tres displays (Q1, Q2, Q3) debe encenderse en cada ciclo.

### 2. Gestión de Entradas

* **Z1, Z2, Z3 (Polling):**
    * Estas zonas se leen en el bucle principal (`while(1)`) mediante funciones de *polling*.
    * La lógica de *polling* actualiza las variables de estado (`estado_alarma`, `segundos_restantes`, `zona_disparada`) según la máquina de estados.

* **P1 (Interrupción Externa):**
    * El pulsador de control maestro (On/Off) se conectó a `INT0` (PD2).
    * La `ISR(INT0_vect)` gestiona el cambio de estado principal (ej. `ACTIVADO` $\rightarrow$ `DESACTIVADO`, o `CONTANDO` $\rightarrow$ `ACTIVADO`).

---

## Diagrama de Estados del Sistema

El comportamiento del sistema se modeló con la siguiente máquina de 6 estados:

1.  **`0: DESACTIVADO`**: Estado inicial. Espera `P1` para activar. Permite probar sensores en `Disp3`.
2.  **`4: RETARDO SALIDA`**: Conteo de 15s tras pulsar `P1`. Muestra cuenta en `Disp1/Disp2`. Si `T=0`, pasa a `ACTIVADO`.
3.  **`1: ACTIVADO`**: Sistema vigilando. Espera `Z1`, `Z2` o `Z3`.
4.  **`3: RETARDO ENTRADA`**: Conteo de 15s tras detectar `Z1`. Muestra cuenta en `Disp1/Disp2`. Si `T=0`, pasa a `SONANDO`.
5.  **`2: SONANDO`**: Conteo de 10s. Activa sirena y muestra cuenta en `Disp1/Disp2`. Si `T=0`, pasa a `POST_ALARMA`.
6.  **`5: POST_ALARMA`**: Conteo de 3s. Muestra la `zona_disparada` en `Disp1`. Si `T=0`, pasa a `ACTIVADO`.

*(Nota: Las zonas `Z2` y `Z3` tienen prioridad y fuerzan el estado `SONANDO` desde los estados `1`, `3` y `4`.)*
